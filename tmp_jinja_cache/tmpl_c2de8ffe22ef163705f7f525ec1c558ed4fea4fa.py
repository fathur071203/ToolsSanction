from jinja2.runtime import LoopContext, Macro, Markup, Namespace, TemplateNotFound, TemplateReference, TemplateRuntimeError, Undefined, escape, identity, internalcode, markup_join, missing, str_join
name = 'screening_results.html'

def root(context, missing=missing):
    resolve = context.resolve_or_missing
    undefined = environment.undefined
    concat = environment.concat
    cond_expr_undefined = Undefined
    if 0: yield None
    parent_template = None
    pass
    parent_template = environment.get_template('base.html', 'screening_results.html')
    for name, parent_block in parent_template.blocks.items():
        context.blocks.setdefault(name, []).append(parent_block)
    yield from parent_template.root_render_func(context)

def block_head(context, missing=missing):
    resolve = context.resolve_or_missing
    undefined = environment.undefined
    concat = environment.concat
    cond_expr_undefined = Undefined
    if 0: yield None
    _block_vars = {}
    pass
    yield "\n<style>\n  /* Premium screening results with horizontal card navigation */\n  .result-header {\n    margin-bottom: 2rem;\n  }\n\n  .result-header h1 {\n    font-size: 2rem;\n    font-weight: 700;\n    color: var(--text-primary);\n    margin-bottom: 1rem;\n  }\n\n  /* Job Summary Cards */\n  .summary-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 1rem;\n    margin-bottom: 2rem;\n  }\n\n  .summary-card {\n    background-color: var(--surface);\n    border: 1px solid var(--border);\n    border-radius: 8px;\n    padding: 1.25rem;\n  }\n\n  .summary-label {\n    font-size: 0.85rem;\n    color: var(--text-secondary);\n    font-weight: 500;\n    margin-bottom: 0.5rem;\n  }\n\n  .summary-value {\n    font-size: 1.5rem;\n    font-weight: 700;\n    color: var(--primary-accent);\n  }\n\n  .summary-value.danger {\n    color: var(--danger);\n  }\n\n  /* Added horizontal scrollable transaction cards */\n  .results-container { margin-top: 2rem; }\n  .results-header { margin-bottom: 1.5rem; }\n  .results-header h2 { margin: 0; font-size: 1.3rem; font-weight: 600; color: var(--text-primary); }\n  .results-info { color: var(--text-secondary); margin-top: 0.5rem; font-size: 0.95rem; }\n  \n  /* Horizontal scrollable transaction cards */\n  .transaction-cards-container {\n    overflow-x: auto;\n    white-space: nowrap;\n    padding: 1rem 0;\n    margin-bottom: 2rem;\n    display: flex;\n    gap: 1rem;\n    scrollbar-width: thin;\n    scrollbar-color: var(--primary-accent) var(--background);\n  }\n  .transaction-cards-container::-webkit-scrollbar {\n    height: 8px;\n  }\n  .transaction-cards-container::-webkit-scrollbar-track {\n    background: var(--background);\n    border-radius: 4px;\n  }\n  .transaction-cards-container::-webkit-scrollbar-thumb {\n    background: var(--primary-accent);\n    border-radius: 4px;\n  }\n  \n  .transaction-card {\n    min-width: 300px;\n    flex-shrink: 0;\n    background-color: var(--surface);\n    border: 2px solid var(--border);\n    border-radius: 12px;\n    padding: 1.25rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    white-space: normal;\n  }\n  .transaction-card:hover {\n    border-color: var(--primary-accent);\n    box-shadow: 0 4px 12px rgba(14, 165, 233, 0.15);\n    transform: translateY(-2px);\n  }\n  .transaction-card.active {\n    border-color: var(--primary-accent);\n    background-color: rgba(14, 165, 233, 0.05);\n    box-shadow: 0 4px 12px rgba(14, 165, 233, 0.2);\n  }\n  .transaction-card-id {\n    font-size: 0.8rem;\n    color: var(--text-light);\n    margin-bottom: 0.5rem;\n    font-weight: 500;\n  }\n  .transaction-card-names {\n    font-size: 0.95rem;\n    color: var(--text-primary);\n    margin-bottom: 0.75rem;\n  }\n  .transaction-card-name {\n    font-weight: 600;\n    margin-bottom: 0.25rem;\n    display: -webkit-box;\n    -webkit-line-clamp: 1;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n  }\n  .transaction-card-label {\n    font-size: 0.75rem;\n    color: var(--text-secondary);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n  }\n  .transaction-card-matches {\n    display: inline-block;\n    background-color: rgba(239, 68, 68, 0.1);\n    color: var(--danger);\n    padding: 0.35rem 0.75rem;\n    border-radius: 20px;\n    font-size: 0.85rem;\n    font-weight: 600;\n  }\n\n  /* Simplified table with only name_score and final_score */\n  .results-section {\n    background-color: var(--surface);\n    border: 1px solid var(--border);\n    border-radius: 12px;\n    overflow: hidden;\n  }\n\n  .table-wrapper {\n    overflow-x: auto;\n  }\n\n  .results-table {\n    width: 100%;\n    border-collapse: collapse;\n    font-size: 0.9rem;\n  }\n\n  .results-table thead th {\n    background-color: var(--background);\n    padding: 1rem;\n    text-align: left;\n    font-weight: 600;\n    color: var(--text-primary);\n    border-bottom: 2px solid var(--border);\n    white-space: nowrap;\n  }\n\n  .results-table tbody td {\n    padding: 1rem;\n    border-bottom: 1px solid var(--border);\n    color: var(--text-primary);\n    vertical-align: top;\n  }\n\n  .results-table tbody tr:hover {\n    background-color: rgba(14, 165, 233, 0.03);\n  }\n\n  .match-row-highlight {\n    background-color: rgba(239, 68, 68, 0.03);\n  }\n\n  .score-badge {\n    display: inline-block;\n    padding: 0.4rem 0.8rem;\n    border-radius: 6px;\n    font-weight: 600;\n    font-size: 0.85rem;\n    font-family: 'Courier New', monospace;\n  }\n\n  .score-high {\n    background-color: rgba(239, 68, 68, 0.1);\n    color: var(--danger);\n  }\n\n  .score-medium {\n    background-color: rgba(245, 158, 11, 0.1);\n    color: var(--warning);\n  }\n\n  .score-low {\n    background-color: rgba(14, 165, 233, 0.1);\n    color: var(--primary-accent);\n  }\n\n  /* Collapsible score breakdown */\n  .score-cell {\n    position: relative;\n  }\n  .score-breakdown-toggle {\n    background: none;\n    border: none;\n    color: var(--primary-accent);\n    cursor: pointer;\n    font-size: 0.75rem;\n    padding: 0.25rem 0;\n    margin-top: 0.25rem;\n    text-decoration: underline;\n    display: block;\n  }\n  .score-breakdown-toggle:hover {\n    color: var(--primary-accent-dark);\n  }\n  .score-breakdown {\n    margin-top: 0.75rem;\n    padding: 0.75rem;\n    background-color: var(--background);\n    border-radius: 6px;\n    font-size: 0.85rem;\n  }\n  .score-breakdown-item {\n    display: flex;\n    justify-content: space-between;\n    padding: 0.25rem 0;\n    color: var(--text-secondary);\n  }\n  .score-breakdown-item strong {\n    color: var(--text-primary);\n  }\n\n  .entity-name {\n    font-weight: 500;\n    color: var(--text-primary);\n  }\n\n  .source-badge {\n    display: inline-block;\n    padding: 0.25rem 0.6rem;\n    border-radius: 999px;\n    background: rgba(14, 165, 233, 0.08);\n    color: var(--primary-accent);\n    font-size: 0.75rem;\n    font-weight: 600;\n    margin-right: 0.35rem;\n    margin-top: 0.25rem;\n  }\n\n  .source-badge.secondary {\n    background: rgba(100, 116, 139, 0.12);\n    color: var(--text-secondary);\n  }\n\n  .entity-meta {\n    font-size: 0.85rem;\n    color: var(--text-light);\n    margin-top: 0.25rem;\n  }\n\n  .empty-results {\n    text-align: center;\n    padding: 3rem 1.5rem;\n    color: var(--text-light);\n  }\n\n  .empty-results-icon {\n    font-size: 3rem;\n    margin-bottom: 1rem;\n  }\n\n  /* Action Buttons */\n  .action-buttons {\n    display: flex;\n    gap: 1rem;\n    margin-top: 2rem;\n  }\n\n  .action-buttons .btn {\n    flex: 1;\n  }\n\n  @media (max-width: 768px) {\n    .result-header h1 {\n      font-size: 1.5rem;\n    }\n\n    .summary-grid {\n      grid-template-columns: 1fr 1fr;\n    }\n\n    .transaction-card {\n      min-width: 250px;\n    }\n\n    .results-table {\n      font-size: 0.8rem;\n    }\n\n    .results-table thead th,\n    .results-table tbody td {\n      padding: 0.75rem 0.5rem;\n    }\n\n    .action-buttons {\n      flex-direction: column;\n    }\n\n    .action-buttons .btn {\n      width: 100%;\n    }\n  }\n</style>\n"

def block_content(context, missing=missing):
    resolve = context.resolve_or_missing
    undefined = environment.undefined
    concat = environment.concat
    cond_expr_undefined = Undefined
    if 0: yield None
    _block_vars = {}
    l_0_job = resolve('job')
    l_0_results = resolve('results')
    l_0_url_for = resolve('url_for')
    try:
        t_1 = environment.filters['length']
    except KeyError:
        @internalcode
        def t_1(*unused):
            raise TemplateRuntimeError("No filter named 'length' found.")
    try:
        t_2 = environment.filters['safe']
    except KeyError:
        @internalcode
        def t_2(*unused):
            raise TemplateRuntimeError("No filter named 'safe' found.")
    try:
        t_3 = environment.filters['tojson']
    except KeyError:
        @internalcode
        def t_3(*unused):
            raise TemplateRuntimeError("No filter named 'tojson' found.")
    pass
    yield '\n<div class="result-header">\n  <h1>Hasil Screening – Job #'
    yield escape(environment.getattr((undefined(name='job') if l_0_job is missing else l_0_job), 'id'))
    yield '</h1>\n  <p style="color: var(--text-secondary); margin: 0;">\n    Batch ID: '
    yield escape(environment.getattr((undefined(name='job') if l_0_job is missing else l_0_job), 'batch_id'))
    yield ' • Status: \n    <span class="badge bg-'
    yield escape(('success' if (environment.getattr((undefined(name='job') if l_0_job is missing else l_0_job), 'status') == 'SUCCESS') else ('danger' if (environment.getattr((undefined(name='job') if l_0_job is missing else l_0_job), 'status') == 'FAILURE') else 'warning')))
    yield '">\n      '
    yield escape(environment.getattr((undefined(name='job') if l_0_job is missing else l_0_job), 'status'))
    yield '\n    </span>\n  </p>\n</div>\n\n<!-- Summary Statistics -->\n<div class="summary-grid">\n  <div class="summary-card">\n    <div class="summary-label">Total Transaksi</div>\n    <div class="summary-value">'
    yield escape(environment.getattr((undefined(name='job') if l_0_job is missing else l_0_job), 'total_transactions'))
    yield '</div>\n  </div>\n  <div class="summary-card">\n    <div class="summary-label">Entitas Sanksi</div>\n    <div class="summary-value">'
    yield escape(environment.getattr((undefined(name='job') if l_0_job is missing else l_0_job), 'total_sanctions'))
    yield '</div>\n  </div>\n  <div class="summary-card">\n    <div class="summary-label">Matches Ditemukan</div>\n    <div class="summary-value danger">'
    yield escape((environment.getattr((undefined(name='job') if l_0_job is missing else l_0_job), 'total_matches') or 0))
    yield '</div>\n  </div>\n  <div class="summary-card">\n    <div class="summary-label">Threshold Final</div>\n    <div class="summary-value" style="color: var(--warning);">'
    yield escape((environment.getattr((undefined(name='job') if l_0_job is missing else l_0_job), 'threshold_score') or 0))
    yield '%</div>\n  </div>\n</div>\n\n'
    if ((undefined(name='results') if l_0_results is missing else l_0_results) and (t_1((undefined(name='results') if l_0_results is missing else l_0_results)) > 0)):
        pass
        yield '\n  <div class="results-container">\n    <div class="results-header">\n      <h2>Transaksi dengan Matches</h2>\n      <div class="results-info">\n        <span id="resultsInfo">Ditemukan <strong>'
        yield escape(t_1((undefined(name='results') if l_0_results is missing else l_0_results)))
        yield '</strong> matches di transaksi</span>\n      </div>\n    </div>\n\n    <!-- Horizontal scrollable transaction cards -->\n    <div class="transaction-cards-container" id="transactionCardsContainer">\n      <!-- Cards will be generated by JavaScript -->\n    </div>\n\n    <!-- Table for selected transaction\'s matches -->\n    <div class="results-section" id="resultsTableContainer">\n      <!-- Table will be generated by JavaScript -->\n    </div>\n  </div>\n'
    else:
        pass
        yield '\n  <div class="results-section">\n    <div class="empty-results">\n      <div class="empty-results-icon">✓</div>\n      <h3 style="color: var(--text-secondary); margin-bottom: 0.5rem;">Tidak ada matches</h3>\n      <p>Semua transaksi di batch ini lolos screening tanpa menemukan kecocokan dengan sanction list.</p>\n    </div>\n  </div>\n'
    yield '\n\n<!-- Action Buttons -->\n<div class="action-buttons">\n  <a href="'
    yield escape(context.call((undefined(name='url_for') if l_0_url_for is missing else l_0_url_for), 'web.screening_jobs', _block_vars=_block_vars))
    yield '" class="btn btn-outline-primary">← Kembali ke Daftar Jobs</a>\n  <a href="'
    yield escape(context.call((undefined(name='url_for') if l_0_url_for is missing else l_0_url_for), 'web.index', _block_vars=_block_vars))
    yield '" class="btn btn-secondary">Kembali ke Dashboard</a>\n  <button class="btn btn-primary" disabled style="opacity: 0.6;">Export Hasil (Coming Soon)</button>\n</div>\n\n<script id="results-data" type="application/json">\n  '
    yield escape(t_2(t_3(context.eval_ctx, (undefined(name='results') if l_0_results is missing else l_0_results))))
    yield '\n</script>\n\n<script>\n  \n  const rawResultsData = document.getElementById(\'results-data\').textContent;\n  let rawResults = [];\n  try {\n    rawResults = JSON.parse(rawResultsData) || [];\n  } catch (e) {\n    console.error("Gagal parsing JSON data:", e);\n  }\n\n  const transactionGroups = {};\n  rawResults.forEach(result => {\n    const txId = result.transaction_id;\n    if (!transactionGroups[txId]) {\n      transactionGroups[txId] = {\n        transaction_id: txId,\n        sender_name: result.sender_name,\n        receiver_name: result.receiver_name,\n        matches: [],\n        sources: new Set()\n      };\n    }\n    if (result.sanction_source_code) {\n      transactionGroups[txId].sources.add(result.sanction_source_code);\n    }\n    transactionGroups[txId].matches.push(result);\n  });\n\n  const transactions = Object.values(transactionGroups).map(tx => {\n    return {\n      ...tx,\n      sources: Array.from(tx.sources || [])\n    };\n  });\n  let selectedTransactionIndex = 0;\n\n  function initializeResults() {\n    if (transactions.length === 0) return;\n\n    const cardsContainer = document.getElementById(\'transactionCardsContainer\');\n    cardsContainer.innerHTML = \'\';\n\n    // Generate cards for each transaction with matches\n    transactions.forEach((tx, index) => {\n      const card = document.createElement(\'div\');\n      card.className = `transaction-card ${index === 0 ? \'active\' : \'\'}`;\n      card.onclick = () => selectTransaction(index);\n      \n      card.innerHTML = `\n        <div class="transaction-card-id">TX #${tx.transaction_id}</div>\n        <div class="transaction-card-names">\n          <div class="transaction-card-label">Sender</div>\n          <div class="transaction-card-name">${tx.sender_name || \'N/A\'}</div>\n          <div class="transaction-card-label" style="margin-top: 0.5rem;">Receiver</div>\n          <div class="transaction-card-name">${tx.receiver_name || \'N/A\'}</div>\n        </div>\n        <div style="margin-bottom: 0.5rem;">\n          <div class="transaction-card-label">Sumber Sanction</div>\n          ${(tx.sources && tx.sources.length > 0) ? tx.sources.map(s => `<span class=\\"source-badge\\">${s}</span>`).join(\'\') : \'<span class="source-badge secondary">UNKNOWN</span>\'}\n        </div>\n        <div class="transaction-card-matches">${tx.matches.length} matches</div>\n      `;\n      \n      cardsContainer.appendChild(card);\n    });\n\n    // Display first transaction\'s matches\n    displayMatchesForTransaction(0);\n  }\n\n  function selectTransaction(index) {\n    selectedTransactionIndex = index;\n    \n    // Update active state on cards\n    const cards = document.querySelectorAll(\'.transaction-card\');\n    cards.forEach((card, i) => {\n      card.classList.toggle(\'active\', i === index);\n    });\n\n    // Display matches for selected transaction\n    displayMatchesForTransaction(index);\n  }\n\n  function displayMatchesForTransaction(index) {\n    const tx = transactions[index];\n    const tableContainer = document.getElementById(\'resultsTableContainer\');\n    \n    let tableHTML = `\n      <div class="table-wrapper">\n        <table class="results-table">\n          <thead>\n            <tr>\n              <th>Nama (Sanksi)</th>\n              <th>Sumber List</th>\n              <th>Role</th>\n              <th>Skor Nama</th>\n              <th>Skor Akhir</th>\n            </tr>\n          </thead>\n          <tbody>\n    `;\n\n    tx.matches.forEach((match, matchIndex) => {\n      const uniqueId = `match-${index}-${matchIndex}`;\n      const nameScoreClass = getScoreClass(match.name_score);\n      const finalScoreClass = getScoreClass(match.final_score);\n      \n      tableHTML += `\n        <tr class="match-row-highlight">\n          <td>\n            <div class="entity-name">${match.sanction_name || \'N/A\'}</div>\n          </td>\n          <td>\n            <span class="source-badge">${match.sanction_source_code || \'UNKNOWN\'}</span>\n          </td>\n          <td>\n            <span class="badge bg-secondary">${match.target_role || \'N/A\'}</span>\n          </td>\n          <td>\n            <span class="score-badge ${nameScoreClass}">${(match.name_score || 0).toFixed(1)}%</span>\n          </td>\n          <td class="score-cell">\n            <span class="score-badge ${finalScoreClass}"><strong>${(match.final_score || 0).toFixed(1)}%</strong></span>\n            <button class="score-breakdown-toggle" onclick="toggleScoreBreakdown(\'${uniqueId}\')">Lihat Detail</button>\n            <div id="breakdown-${uniqueId}" class="score-breakdown" style="display: none;">\n              <div class="score-breakdown-item">\n                <span>Skor Nama:</span>\n                <strong>${(match.name_score || 0).toFixed(1)}%</strong>\n              </div>\n              <div class="score-breakdown-item">\n                <span>Skor DOB:</span>\n                <strong>${(match.dob_score || 0).toFixed(1)}%</strong>\n              </div>\n              <div class="score-breakdown-item">\n                <span>Skor Citizenship:</span>\n                <strong>${(match.citizenship_score || 0).toFixed(1)}%</strong>\n              </div>\n              <div class="score-breakdown-item" style="border-top: 1px solid var(--border); margin-top: 0.5rem; padding-top: 0.5rem;">\n                <span><strong>Skor Akhir:</strong></span>\n                <strong style="color: var(--danger);">${(match.final_score || 0).toFixed(1)}%</strong>\n              </div>\n            </div>\n          </td>\n        </tr>\n      `;\n    });\n\n    tableHTML += `\n          </tbody>\n        </table>\n      </div>\n    `;\n\n    tableContainer.innerHTML = tableHTML;\n  }\n\n  function toggleScoreBreakdown(uniqueId) {\n    const breakdown = document.getElementById(`breakdown-${uniqueId}`);\n    if (breakdown.style.display === \'none\') {\n      breakdown.style.display = \'block\';\n    } else {\n      breakdown.style.display = \'none\';\n    }\n  }\n\n  function getScoreClass(score) {\n    if (score >= 70) return \'score-high\';\n    if (score >= 40) return \'score-medium\';\n    return \'score-low\';\n  }\n\n  // Initialize on page load\n  if (transactions.length > 0) {\n    initializeResults();\n  }\n</script>\n'

blocks = {'head': block_head, 'content': block_content}
debug_info = '1=12&3=17&319=27&321=57&323=59&324=61&325=63&334=65&338=67&342=69&346=71&350=73&355=76&381=82&382=84&387=86'